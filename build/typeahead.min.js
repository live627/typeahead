var xtend=require("xtend"),dom=require("dom"),defaults={source:[],items:8,menu:'<ul class="typeahead hidden"></ul>',item:'<li><a href="#"></a></li>',minLength:1,autoselect:!0},Typeahead=function(e,t){if(!(this instanceof Typeahead))return new Typeahead(e,t);var o=this;o.element=dom(e),o.options=xtend({},defaults,t),o.matcher=o.options.matcher||o.matcher,o.sorter=o.options.sorter||o.sorter,o.highlighter=o.options.highlighter||o.highlighter,o.updater=o.options.updater||o.updater,o.menu=dom(o.options.menu),dom(document.body).append(o.menu),o.source=o.options.source,o.shown=!1,o.listen()},proto=Typeahead.prototype;proto.constructor=Typeahead,proto.select=function(){var e=this,t=e.menu.find(".active").attr("data-value");return e.element.value(e.updater(t)).emit("change"),e.hide()},proto.updater=function(e){return e},proto.show=function(){for(var e=this,t=e.element.offset(),o=xtend({},t,{height:e.element.outerHeight()}),n=0,r=e.element[0];r=r.parentElement;)n+=r.scrollTop;var i=o.top+o.height-n+"px",s="auto",a=o.left+"px";return"above"===e.options.position?(i="auto",s=document.body.clientHeight-o.top+3):"right"===e.options.position&&(i=parseInt(i.split("px")[0],10)-e.element.outerHeight()+"px",a=parseInt(a.split("px")[0],10)+e.element.outerWidth()+"px"),e.menu.css({top:i,bottom:s,left:a}),e.menu.removeClass("hidden"),e.shown=!0,e},proto.hide=function(){return this.menu.addClass("hidden"),this.shown=!1,this},proto.lookup=function(e){var t=this;return t.query=t.element.value(),!t.query||t.query.length<t.options.minLength?t.shown?t.hide():t:(t.source instanceof Function?t.source(t.query,t.process.bind(t)):t.process(t.source),t)},proto.process=function(e){var t=this;return e=e.filter(t.matcher.bind(t)),e=t.sorter(e),e.length?t.render(e.slice(0,t.options.items)).show():t.shown?t.hide():t},proto.matcher=function(e){return~e.toLowerCase().indexOf(this.query.toLowerCase())},proto.sorter=function(e){for(var t,o=[],n=[],r=[];t=e.shift();)t.toLowerCase().indexOf(this.query.toLowerCase())?~t.indexOf(this.query)?n.push(t):r.push(t):o.push(t);return o.concat(n,r)},proto.highlighter=function(e){var t=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return e.replace(new RegExp("("+t+")","ig"),function(e,t){return"<strong>"+t+"</strong>"})},proto.render=function(e){var t=this;return e=e.map(function(e){var o=dom(t.options.item);return o.attr("data-value",e).find("a").html(t.highlighter(e)),o}),t.options.autoselect&&e[0].addClass("active"),t.menu.empty(),e.forEach(function(e){t.menu.append(e)}),this},proto.next=function(e){var t=this.menu.find(".active").removeClass("active"),o=t.next();o.length||(o=this.menu.find("li").first()),o.addClass("active")},proto.prev=function(e){var t=this.menu.find(".active").removeClass("active"),o=t.prev();o.length||(o=this.menu.find("li").last()),o.addClass("active")},proto.listen=function(){var e=this;e.element.on("blur",e.blur.bind(e)).on("keypress",e.keypress.bind(e)).on("keyup",e.keyup.bind(e)).on("keydown",e.keydown.bind(e)),e.menu.on("click",e.click.bind(e)).on("mouseenter","li",e.mouseenter.bind(e))},proto.move=function(e){if(this.shown){switch(e.keyCode){case 9:case 13:case 27:e.preventDefault();break;case 38:e.preventDefault(),this.prev();break;case 40:e.preventDefault(),this.next()}e.stopPropagation()}},proto.keydown=function(e){this.suppressKeyPressRepeat=[40,38,9,13,27].indexOf(e.keyCode)>=0,this.move(e)},proto.keypress=function(e){this.suppressKeyPressRepeat||this.move(e)},proto.keyup=function(e){var t=this;switch(e.keyCode){case 40:case 38:break;case 9:case 13:if(!t.shown)return;t.select();break;case 27:if(!t.shown)return;t.hide();break;default:t.lookup()}e.stopPropagation(),e.preventDefault()},proto.blur=function(e){var t=this;setTimeout(function(){t.hide()},150)},proto.click=function(e){e.stopPropagation(),e.preventDefault(),this.select()},proto.mouseenter=function(e){this.menu.find(".active").removeClass("active"),dom(e.currentTarget).addClass("active")},module.exports=Typeahead;
//# sourceMappingURL=build/typeahead.min.js.map
